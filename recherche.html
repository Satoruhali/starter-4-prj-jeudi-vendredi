<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Projet — Landing page</title>


    <link rel="stylesheet" href="styles.css" />
  </head>

  <body>
    <header class="site-header">
      <div class="container site-header__inner">
       <a class="brand" href="#">
      <img class="brand__logo" src="./assets/logo-comparemanga.svg" alt="Logo du projet" 
      width="60" height="60" />
        <span class="brand__name">CompareManga</span>
    </a>

      <!-- PAR ces lignes -->
      <nav class="site-nav" aria-label="Navigation principale">
        <a class="site-nav__link active" href="#accueil">Accueil</a>
        <a class="site-nav__link" href="#comparer">Comparer</a>
        <a class="site-nav__link" href="#boutiques">Boutiques</a>
      </nav>

      </div>
    </header>

    <main>
      <body>
         <main>
        <div class="container">
            <!-- Ajouter un titre dynamique -->
            <h1 class="site-title" id="search-title">Résultats pour : <span id="search-query"></span></h1>
            
            <!-- Filtres existants avec modifications -->
            <div class="filters">
                <div class="filter-group">
                    <span class="filter-label">Trier par</span>
                    <select class="filter-select" id="sort-order">
                        <option value="relevance">Pertinence</option>
                        <option value="title.asc">Titre (A-Z)</option>
                        <option value="title.desc">Titre (Z-A)</option>
                        <option value="year.asc">Année (croissant)</option>
                        <option value="year.desc">Année (décroissant)</option>
                    </select>
                </div>
            </div>
            
            <!-- Zone de résultats -->
            <div class="result-count" id="result-count"></div>
            <div class="products-grid" id="results-grid">
                <!-- Les résultats seront injectés ici -->
                <div class="loading">Chargement...</div>
            </div>
        </div>
    </main>

    <!-- Footer existant -->
    <footer class="site-footer">
        <!-- ... -->
    <script>
        // Récupérer le terme de recherche depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const searchQuery = urlParams.get('q') || 'naruto'; // Valeur par défaut
        
        // Afficher le terme recherché
        document.getElementById('search-query').textContent = searchQuery;
        document.title = `Recherche : ${searchQuery} - CompareManga`;
        
        // Fonction pour rechercher des mangas via l'API MangaDex
        async function searchManga(query, limit = 20, offset = 0, sort = 'relevance') {
            try {
               // NOUVELLE ligne (à mettre)
            const response = await fetch(`/api/mangadex/manga?title=${encodeURIComponent(query)}&limit=${limit}&offset=${offset}&order[${sort}]=desc&includes[]=cover_art`);
            
                            
                if (!response.ok) {
                    throw new Error(`Erreur API: ${response.status}`);
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Erreur lors de la recherche:', error);
                return null;
            }
        }


        // Fonction pour obtenir l'URL de couverture
        function getCoverUrl(mangaId, fileName) {
            return `https://uploads.mangadex.org/covers/${mangaId}/${fileName}.512.jpg`;
        }
        
        // Fonction pour afficher les résultats
        function displayResults(data) {
            const resultsGrid = document.getElementById('results-grid');
            const resultCount = document.getElementById('result-count');
            
            if (!data || !data.data || data.data.length === 0) {
                resultsGrid.innerHTML = '<div class="no-results">Aucun manga trouvé</div>';
                resultCount.textContent = '0 résultat';
                return;
            }
            
            // Afficher le nombre de résultats
            resultCount.textContent = `${data.data.length} résultat${data.data.length > 1 ? 's' : ''}`;
            
            // Générer le HTML pour chaque manga
            const mangaHTML = data.data.map(manga => {
                const attributes = manga.attributes;
                const title = attributes.title?.en || Object.values(attributes.title)[0] || 'Titre inconnu';
                const description = attributes.description?.en || 'Pas de description disponible';
                const year = attributes.year || 'N/A';
                const status = attributes.status || 'inconnu';
                
                // Trouver l'image de couverture
                const coverArt = manga.relationships.find(rel => rel.type === 'cover_art');
                const coverUrl = coverArt ? 
                    `https://uploads.mangadex.org/covers/${manga.id}/${coverArt.attributes?.fileName}.512.jpg` : 
                    'https://via.placeholder.com/350x500?text=Pas+de+couverture';
                
                return `
                    <div class="product-card manga-card">
                        <div class="manga-cover">
                            <img src="${coverUrl}" alt="${title}" loading="lazy">
                        </div>
                        <h2 class="product-title">${title}</h2>
                        <div class="product-details">
                            <p><strong>Année :</strong> ${year}</p>
                            <p><strong>Statut :</strong> ${status}</p>
                            <p class="manga-description">${description.substring(0, 150)}${description.length > 150 ? '...' : ''}</p>
                        </div>
                        <div class="product-rating">
                            <span class="stars">${getRatingStars(manga.attributes.rating?.average || 0)}</span>
                            <span class="reviews">${Math.round(manga.attributes.rating?.bayesian || 0)}</span>
                        </div>
                        <a href="manga-details.html?id=${manga.id}" class="price-link">Voir les détails →</a>
                    </div>
                `;
            }).join('');
            
            resultsGrid.innerHTML = mangaHTML;
        }
        
        // Fonction pour générer des étoiles de notation
        function getRatingStars(rating) {
            const stars = Math.round(rating / 2); // Convertir sur 5 étoiles
            return '★'.repeat(stars) + '☆'.repeat(5 - stars);
        }
        
        // Écouter les changements de tri
        document.getElementById('sort-order').addEventListener('change', (e) => {
            loadResults(searchQuery, e.target.value);
        });
        
        // Charger les résultats
        async function loadResults(query, sort = 'relevance') {
            const resultsGrid = document.getElementById('results-grid');
            resultsGrid.innerHTML = '<div class="loading">Chargement...</div>';
            
            const data = await searchManga(query, 20, 0, sort);
            displayResults(data);
        }
        
        // Chargement initial
        loadResults(searchQuery);
    </script>


      <section class="section section--alt" id="contact">
        <div class="container">
          <h2 class="section__title">Contact</h2>
          <p class="section__lead">
              Une idée, une question ou envie de suivre le projet ?
          </p>

          <div class="contact">
             <a class="btn btn--primary" href="mailto:ton.email@example.com">Envoyer un email</a>
            <a class="btn btn--ghost" href="#">Lien / réseau</a>
          </div>
        </div>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container site-footer__inner">
        <p class="site-footer__text">
          © <span id="year">2026</span> — CompareManga 
        </p>
      </div>
    </footer>
  </body>
</html>

